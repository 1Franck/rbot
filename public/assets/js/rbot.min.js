/*! build 2015-06-23 22:06:13 */
/*! rbot.js */
/*! Copyright Francois Lajoie */
/*! MIT License */
"use strict";var app=angular.module("rbot",[]),cmd_prefix=cmd_prefix||"#";app.filter("to_trusted",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),app.service("rbotApiService",["$http",function(a){var b=function(b,c,d){a.post("index.php",b).success(function(a){"function"==typeof c&&c(a)}).error(function(){"function"==typeof d&&d()})};this.getConsoleHistory=function(a,c){b({h:1},a,c)},this.getCommandHistory=function(a,c){b({ch:1},a,c)},this.commandRequest=function(a,c,d){b(a,c,d)},this.request=function(a,c){b({ch:1},a,c)},this.post=function(a,c,d){b(a,c,d)}}]),app.controller("consoleController",["$scope","rbotApiService",function(a,b){function c(c){d(a.cmd_input)&&i[a.cmd_input]()===!1||b.commandRequest({cmd:a.cmd_input},function(a){c&&c(),a.error&&(h.console.innerHTML=a.error)},function(){console.log("Cannot resolve: "+a.cmd_input)})}function d(a){return i[a]?!0:!1}function f(){document.body.addEventListener("dblclick",function(){console.log("dlclock"),document.getElementById("cmd").focus()});var a=function(a){(38==a.keyCode||40==a.keyCode)&&a.preventDefault()};h.cmd.addEventListener("keydown",a,!1),h.cmd.addEventListener("keypress",a,!1)}a.cmd_history=[],a.cmd_history_index=0,a.cmd_input=cmd_prefix,a.cmd_input_default=cmd_prefix;var g=6e4,h={cmd:document.getElementById("cmd"),console:document.getElementById("console")},i={clear:function(){return h.console.innerHTML="",!1},"#exit":function(){h.console.innerHTML=""}};a.getConsoleHistory=function(){b.getConsoleHistory(function(a){a.length>0&&(a.error?h.console.innerHTML=a.error:(h.console.innerHTML+="\n"+a+"&nbsp;",h.console.scrollTop=h.console.scrollHeight,""!=a&&k.update()))},function(){console.log("Cannot retreive history")})},a.getCommandHistory=function(){b.getCommandHistory(function(b){b.length>0&&(a.cmd_history=b,a.cmd_history_index=b.length)},function(){console.log("Cannot retreive command history")})},a.getCommandHistory(),a.cmdTyping=function(b){var d=window.event?b.keyCode:b.which;13==d?a.cmd_input===cmd_prefix||""===a.cmd_input?(h.console.innerHTML+="\n",h.console.scrollTop=h.console.scrollHeight):(c(a.getConsoleHistory),void 0!==a.cmd_history[a.cmd_history.length-1]&&a.cmd_input!==a.cmd_history[a.cmd_history.length-1].command&&(a.cmd_history.push({command:a.cmd_input}),a.cmd_history_index=a.cmd_history.length),a.cmd_input=a.cmd_input_default):8==d?a.cmd_input==cmd_prefix&&(a.cmd_input=""):38==d?(a.cmd_history_index--,a.cmd_history_index<0?a.cmd_history_index=0:void 0!==a.cmd_history[a.cmd_history_index]&&(a.cmd_input=a.cmd_history[a.cmd_history_index].command.trim()),b.preventDefault()):40==d?(a.cmd_history_index++,a.cmd_history_index>a.cmd_history.length-1?(a.cmd_history_index--,a.cmd_input=""):void 0!==a.cmd_history[a.cmd_history_index].command&&(a.cmd_input=a.cmd_history[a.cmd_history_index].command.trim()),b.preventDefault()):""==a.cmd_input.trim()&&32==d&&(a.cmd_input="#")},a.focusCmd=function(){h.cmd.focus()};var j=new Worker("assets/js/ww/history.js");j.onmessage=function(a){var b=a.data.data;b.length>0&&(h.console.innerHTML+="\n"+b+"&nbsp;",h.console.scrollTop=h.console.scrollHeight,k.update())},j.postMessage({ts:"sd"});var k=function(){var a=new Worker("assets/js/ww/updatetime.js");return a.onerror=function(){console.log("there was a problem with the WebWorker within "+e)},{update:function(){var b=document.querySelectorAll(".line-ts"),c="";a.onmessage=function(a){"update"==a.data.action&&b[a.data.index]&&(b[a.data.index].innerHTML=a.data.time)};for(var d=0;d<b.length;d++){var e=b[d].getAttribute("data-ts");void 0!==e&&""!=e.trim()&&(c==e?h.console.removeChild(b[d]):(a.postMessage({ts:b[d].getAttribute("data-ts"),index:d}),c=e))}}}}();setInterval(k.update,g),f()}]);