/*! build 2015-06-06 19:06:46 */
/*! rbot.js */
/*! Copyright Francois Lajoie */
/*! MIT License */
"use strict";var app=angular.module("rbot",[]),cmd_prefix=cmd_prefix||"#";app.filter("to_trusted",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),app.controller("consoleController",["$scope","$http",function(a,b){function c(c){return d(a.cmd_input)?void g[a.cmd_input]():void b.post("index.php",{cmd:a.cmd_input}).success(function(a){c&&c(),a.error&&(f.console.innerHTML=a.error)}).error(function(){console.log("Cannot resolve: "+a.cmd_input)})}function d(a){return g[a]?!0:!1}function e(){document.body.addEventListener("dblclick",function(){console.log("dlclock"),document.getElementById("cmd").focus()});var a=!1,b=function(b){return a?void b.preventDefault():void((38==b.keyCode||40==b.keyCode)&&b.preventDefault())};f.cmd.addEventListener("keydown",b,!1),f.cmd.addEventListener("keypress",b,!1)}a.cmd_history=[],a.cmd_history_index=0,a.cmd_input=cmd_prefix,a.cmd_input_default=cmd_prefix;var f={cmd:document.getElementById("cmd"),console:document.getElementById("console")},g={clear:function(){f.console.innerHTML=""}};a.getConsoleHistory=function(){b.post("index.php",{h:1}).success(function(a){a.length>0&&(a.error?f.console.innerHTML=a.error:(f.console.innerHTML+="\n"+a,f.console.scrollTop=f.console.scrollHeight))}).error(function(){console.log("Cannot retreive history")})},setInterval(function(){a.getConsoleHistory()},1e3),a.getCommandHistory=function(){b.post("index.php",{ch:1}).success(function(b){b.length>0&&(a.cmd_history=b,a.cmd_history_index=b.length)}).error(function(){console.log("Cannot retreive command history")})},a.getCommandHistory(),a.cmdTyping=function(b){var d=window.event?b.keyCode:b.which;13==d?a.cmd_input===cmd_prefix||""===a.cmd_input?(f.console.innerHTML+="\n",f.console.scrollTop=f.console.scrollHeight):(c(a.getConsoleHistory),a.cmd_input!==a.cmd_history[a.cmd_history.length-1].command&&(a.cmd_history.push({command:a.cmd_input}),a.cmd_history_index=a.cmd_history.length),a.cmd_input=a.cmd_input_default):8==d?a.cmd_input==cmd_prefix&&(a.cmd_input=""):38==d?(a.cmd_history_index--,a.cmd_history_index<0?a.cmd_history_index=0:a.cmd_input=a.cmd_history[a.cmd_history_index].command.trim(),b.preventDefault()):40==d?(a.cmd_history_index++,a.cmd_history_index>a.cmd_history.length-1?(a.cmd_history_index--,a.cmd_input=""):void 0!==a.cmd_history[a.cmd_history_index].command&&(a.cmd_input=a.cmd_history[a.cmd_history_index].command.trim()),b.preventDefault()):""==a.cmd_input.trim()&&32==d&&(a.cmd_input="$")},a.focusCmd=function(){f.cmd.focus()},e()}]);