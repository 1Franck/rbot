/*! build 2015-06-20 18:06:25 */
/*! rbot.js */
/*! Copyright Francois Lajoie */
/*! MIT License */
"use strict";var app=angular.module("rbot",[]),cmd_prefix=cmd_prefix||"#";app.filter("to_trusted",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),app.service("rbotApiService",["$http",function(a){var b=function(b,c,d){a.post("index.php",b).success(function(a){"function"==typeof c&&c(a)}).error(function(){"function"==typeof d&&d()})};this.getConsoleHistory=function(a,c){b({h:1},a,c)},this.getCommandHistory=function(a,c){b({ch:1},a,c)},this.commandRequest=function(a,c,d){b(a,c,d)},this.request=function(a,c){b({ch:1},a,c)},this.post=function(a,c,d){b(a,c,d)}}]),app.controller("consoleController",["$scope","rbotApiService",function(a,b){function c(c){return d(a.cmd_input)?void g[a.cmd_input]():void b.commandRequest({cmd:a.cmd_input},function(a){c&&c(),a.error&&(f.console.innerHTML=a.error)},function(){console.log("Cannot resolve: "+a.cmd_input)})}function d(a){return g[a]?!0:!1}function e(){document.body.addEventListener("dblclick",function(){console.log("dlclock"),document.getElementById("cmd").focus()});var a=function(a){(38==a.keyCode||40==a.keyCode)&&a.preventDefault()};f.cmd.addEventListener("keydown",a,!1),f.cmd.addEventListener("keypress",a,!1)}a.cmd_history=[],a.cmd_history_index=0,a.cmd_input=cmd_prefix,a.cmd_input_default=cmd_prefix;var f={cmd:document.getElementById("cmd"),console:document.getElementById("console")},g={clear:function(){f.console.innerHTML=""}};a.getConsoleHistory=function(){b.getConsoleHistory(function(a){console.log(a),a.length>0&&(a.error?f.console.innerHTML=a.error:(f.console.innerHTML+="\n"+a,f.console.scrollTop=f.console.scrollHeight))},function(){console.log("Cannot retreive history")})},setInterval(function(){a.getConsoleHistory()},1e3),a.getCommandHistory=function(){b.getCommandHistory(function(b){b.length>0&&(a.cmd_history=b,a.cmd_history_index=b.length)},function(){console.log("Cannot retreive command history")})},a.getCommandHistory(),a.cmdTyping=function(b){var d=window.event?b.keyCode:b.which;13==d?a.cmd_input===cmd_prefix||""===a.cmd_input?(f.console.innerHTML+="\n",f.console.scrollTop=f.console.scrollHeight):(c(a.getConsoleHistory),void 0!==a.cmd_history[a.cmd_history.length-1]&&a.cmd_input!==a.cmd_history[a.cmd_history.length-1].command&&(a.cmd_history.push({command:a.cmd_input}),a.cmd_history_index=a.cmd_history.length),a.cmd_input=a.cmd_input_default):8==d?a.cmd_input==cmd_prefix&&(a.cmd_input=""):38==d?(a.cmd_history_index--,a.cmd_history_index<0?a.cmd_history_index=0:void 0!==a.cmd_history[a.cmd_history_index]&&(a.cmd_input=a.cmd_history[a.cmd_history_index].command.trim()),b.preventDefault()):40==d?(a.cmd_history_index++,a.cmd_history_index>a.cmd_history.length-1?(a.cmd_history_index--,a.cmd_input=""):void 0!==a.cmd_history[a.cmd_history_index].command&&(a.cmd_input=a.cmd_history[a.cmd_history_index].command.trim()),b.preventDefault()):""==a.cmd_input.trim()&&32==d&&(a.cmd_input="#")},a.focusCmd=function(){f.cmd.focus()},e()}]);