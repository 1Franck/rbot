/*! build 2015-06-21 21:06:20 */
/*! rbot.js */
/*! Copyright Francois Lajoie */
/*! MIT License */
"use strict";var app=angular.module("rbot",[]),cmd_prefix=cmd_prefix||"#";app.filter("to_trusted",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),app.service("rbotApiService",["$http",function(a){var b=function(b,c,d){a.post("index.php",b).success(function(a){"function"==typeof c&&c(a)}).error(function(){"function"==typeof d&&d()})};this.getConsoleHistory=function(a,c){b({h:1},a,c)},this.getCommandHistory=function(a,c){b({ch:1},a,c)},this.commandRequest=function(a,c,d){b(a,c,d)},this.request=function(a,c){b({ch:1},a,c)},this.post=function(a,c,d){b(a,c,d)}}]),app.controller("consoleController",["$scope","rbotApiService",function(a,b){function c(c){e(a.cmd_input)&&j[a.cmd_input]()===!1||b.commandRequest({cmd:a.cmd_input},function(a){c&&c(),a.error&&(i.console.innerHTML=a.error)},function(){console.log("Cannot resolve: "+a.cmd_input)})}function d(){var a=document.querySelectorAll(".line-ts"),b="";h=.5*h*a.length;for(var c=0;c<a.length;c++)""==a[c].getAttribute("data-ts").trim()&&a[c].classList.remove("line-ts");console.log(a.length);for(var c=0;c<a.length;c++){var d=a[c].getAttribute("data-ts");void 0!==d&&""!=d.trim()&&(b==d?(a[c].innerHTML="",a[c].setAttribute("data-ts","")):(a[c].innerHTML=prettyDate(d),b=d))}}function e(a){return j[a]?!0:!1}function f(){document.body.addEventListener("dblclick",function(){console.log("dlclock"),document.getElementById("cmd").focus()});var a=function(a){(38==a.keyCode||40==a.keyCode)&&a.preventDefault()};i.cmd.addEventListener("keydown",a,!1),i.cmd.addEventListener("keypress",a,!1)}a.cmd_history=[],a.cmd_history_index=0,a.cmd_input=cmd_prefix,a.cmd_input_default=cmd_prefix;var g=5e3,h=1e4,i={cmd:document.getElementById("cmd"),console:document.getElementById("console")},j={clear:function(){return i.console.innerHTML="",!1},"#exit":function(){i.console.innerHTML=""}};a.getConsoleHistory=function(){b.getConsoleHistory(function(a){a.length>0&&(a.error?i.console.innerHTML=a.error:(i.console.innerHTML+="\n"+a+"&nbsp;",i.console.scrollTop=i.console.scrollHeight,""!=a&&d()))},function(){console.log("Cannot retreive history")})},setInterval(function(){a.getConsoleHistory()},g),a.getCommandHistory=function(){b.getCommandHistory(function(b){b.length>0&&(a.cmd_history=b,a.cmd_history_index=b.length)},function(){console.log("Cannot retreive command history")})},a.getCommandHistory(),a.cmdTyping=function(b){var d=window.event?b.keyCode:b.which;13==d?a.cmd_input===cmd_prefix||""===a.cmd_input?(i.console.innerHTML+="\n",i.console.scrollTop=i.console.scrollHeight):(c(a.getConsoleHistory),void 0!==a.cmd_history[a.cmd_history.length-1]&&a.cmd_input!==a.cmd_history[a.cmd_history.length-1].command&&(a.cmd_history.push({command:a.cmd_input}),a.cmd_history_index=a.cmd_history.length),a.cmd_input=a.cmd_input_default):8==d?a.cmd_input==cmd_prefix&&(a.cmd_input=""):38==d?(a.cmd_history_index--,a.cmd_history_index<0?a.cmd_history_index=0:void 0!==a.cmd_history[a.cmd_history_index]&&(a.cmd_input=a.cmd_history[a.cmd_history_index].command.trim()),b.preventDefault()):40==d?(a.cmd_history_index++,a.cmd_history_index>a.cmd_history.length-1?(a.cmd_history_index--,a.cmd_input=""):void 0!==a.cmd_history[a.cmd_history_index].command&&(a.cmd_input=a.cmd_history[a.cmd_history_index].command.trim()),b.preventDefault()):""==a.cmd_input.trim()&&32==d&&(a.cmd_input="#")},a.focusCmd=function(){i.cmd.focus()},setInterval(d,h),f()}]);